#!/bin/bash

# Define repository URL and the directory where the repository will be cloned
REPO_URL="https://github.com/somadina6/cryptovision-ai-app.git"
APP_DIR="/var/www/html/cryptovision-ai-app"

# Navigate to the parent directory
cd /var/www/html || { echo "Failed to change directory"; exit 1; }

# Remove the existing application directory
rm -rf "$APP_DIR"

# Clone the repository afresh
git clone "$REPO_URL" "$APP_DIR" || { echo "Failed to clone repository"; exit 1; }

# Navigate to the application directory
cd "$APP_DIR" || { echo "Failed to change directory"; exit 1; }

# Install any new dependencies
npm install || { echo "Failed to install dependencies"; exit 1; }

# Build the application if necessary
npm run build || { echo "Build failed"; exit 1; }

# Restart the PM2 process
pm2 restart crypto-app || { echo "Failed to restart PM2 process"; exit 1; }

# Optionally, save the PM2 process list
pm2 save || { echo "Failed to save PM2 process list"; exit 1; }

echo "Deployment complete and PM2 process restarted."
